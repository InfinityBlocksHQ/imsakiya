<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Infinity Imsakiya</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Orbitron:wght@400;700&family=Tajawal:wght@300;500;700&display=swap" rel="stylesheet">

<style>
  :root {
    --bg-deep: #050505;
    --glass-bg: rgba(20, 20, 20, 0.6);
    --glass-border: 1px solid rgba(255, 215, 0, 0.15);
    --text-main: #ECECEC;
    --text-dim: #9CA3AF;
    --gold: #FFD700;
    --accent-glow: 0 0 15px rgba(255, 215, 0, 0.2);
  }

  body {
    background-color: var(--bg-deep);
    color: var(--text-main);
    font-family: 'Tajawal', sans-serif;
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  /* =========================================
     1. Ø®Ù„ÙÙŠØ© Ø§Ù„Ù†Ø¬ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© (Infinity Style)
     ========================================= */
  .stars {
    position: absolute;
    width: 100%; height: 100%;
    background-image: 
        radial-gradient(1px 1px at 50px 50px, white, transparent),
        radial-gradient(1px 1px at 100px 150px, rgba(255,255,255,0.5), transparent),
        radial-gradient(1.5px 1.5px at 200px 300px, white, transparent),
        radial-gradient(2px 2px at 350px 80px, rgba(255,215,0,0.3), transparent);
    background-size: 400px 400px;
    animation: starAnim 60s linear infinite;
    z-index: -1;
  }
  @keyframes starAnim { from { transform: translateY(0); } to { transform: translateY(-400px); } }

  /* =========================================
     2. Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¥Ù…Ø³Ø§ÙƒÙŠØ© Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ©
     ========================================= */
  .imsakiya-card {
    background: var(--glass-bg);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: var(--glass-border);
    border-radius: 24px;
    padding: 30px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    position: relative;
  }

  /* =========================================
     3. Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ)
     ========================================= */
  .header-info {
    margin-bottom: 20px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    padding-bottom: 15px;
  }

  .city-name {
    font-size: 0.9rem;
    color: var(--gold);
    letter-spacing: 1px;
    text-transform: uppercase;
    display: flex; align-items: center; justify-content: center; gap: 5px;
  }

  .date-display {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.8rem;
    color: var(--text-dim);
    margin-top: 5px;
  }

  .countdown-box {
    margin: 20px 0;
  }

  .next-prayer-label {
    font-size: 0.9rem;
    color: var(--text-dim);
  }

  .countdown-timer {
    font-family: 'Orbitron', sans-serif;
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--text-main);
    text-shadow: 0 0 10px rgba(255,255,255,0.3);
    margin-top: 5px;
  }

  /* =========================================
     4. Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØµÙ„ÙˆØ§Øª
     ========================================= */
  .prayer-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .prayer-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    border-radius: 12px;
    background: rgba(255,255,255,0.03);
    transition: all 0.3s ease;
  }

  .prayer-name {
    font-family: 'Amiri', serif;
    font-size: 1.1rem;
  }

  .prayer-time {
    font-family: 'Orbitron', sans-serif;
    font-size: 1rem;
    color: var(--text-dim);
  }

  /* ØªÙ…ÙŠÙŠØ² Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© */
  .prayer-row.active {
    background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), transparent);
    border-right: 3px solid var(--gold);
    box-shadow: var(--accent-glow);
  }

  .prayer-row.active .prayer-name,
  .prayer-row.active .prayer-time {
    color: var(--gold);
    font-weight: bold;
  }

  /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ØµØºÙŠØ±Ø© (Ù‡Ù„Ø§Ù„/Ø´Ù…Ø³) */
  .icon-indicator { font-size: 0.8rem; margin-left: 5px; opacity: 0.7; }

  /* Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
  .location-btn {
    position: absolute;
    top: 15px; left: 15px;
    background: none; border: 1px solid rgba(255,255,255,0.2);
    color: var(--text-dim);
    border-radius: 50%; width: 30px; height: 30px;
    cursor: pointer; font-size: 12px;
    transition: 0.3s;
  }
  .location-btn:hover { border-color: var(--gold); color: var(--gold); }

</style>
</head>
<body>

  <div class="stars"></div>

  <div class="imsakiya-card">
    <button class="location-btn" onclick="getLocation()" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹">ğŸ“</button>
    
    <div class="header-info">
      <div class="city-name">
        <span id="location-text">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©ØŒ Ù…ØµØ±</span>
      </div>
      <div class="date-display" id="date-text">-- / -- / ----</div>
    </div>

    <div class="countdown-box">
      <div class="next-prayer-label">Ø§Ù„Ù…ØªØ¨Ù‚Ù‰ Ø¹Ù„Ù‰ <span id="next-prayer-name" style="color:var(--gold)">...</span></div>
      <div class="countdown-timer" id="countdown">00:00:00</div>
    </div>

    <div class="prayer-list" id="prayer-list">
      <div class="prayer-row" id="row-Fajr">
        <span class="prayer-name">Ø§Ù„ÙØ¬Ø± ğŸŒ‘</span>
        <span class="prayer-time" id="time-Fajr">--:--</span>
      </div>
      <div class="prayer-row" id="row-Sunrise">
        <span class="prayer-name">Ø§Ù„Ø´Ø±ÙˆÙ‚ â˜€ï¸</span>
        <span class="prayer-time" id="time-Sunrise">--:--</span>
      </div>
      <div class="prayer-row" id="row-Dhuhr">
        <span class="prayer-name">Ø§Ù„Ø¸Ù‡Ø±</span>
        <span class="prayer-time" id="time-Dhuhr">--:--</span>
      </div>
      <div class="prayer-row" id="row-Asr">
        <span class="prayer-name">Ø§Ù„Ø¹ØµØ±</span>
        <span class="prayer-time" id="time-Asr">--:--</span>
      </div>
      <div class="prayer-row" id="row-Maghrib">
        <span class="prayer-name">Ø§Ù„Ù…ØºØ±Ø¨ ğŸŒ™</span>
        <span class="prayer-time" id="time-Maghrib">--:--</span>
      </div>
      <div class="prayer-row" id="row-Isha">
        <span class="prayer-name">Ø§Ù„Ø¹Ø´Ø§Ø¡</span>
        <span class="prayer-time" id="time-Isha">--:--</span>
      </div>
    </div>
  </div>

<script>
  // ==========================================
  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©)
  // ==========================================
  let userLat = 30.0444;
  let userLng = 31.2357;
  let prayerTimes = {};
  
  // Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØµÙ„ÙˆØ§Øª Ù„Ù„Ø¹Ø±Ø¶
  const prayerNamesAr = {
    Fajr: "Ø§Ù„ÙØ¬Ø±",
    Sunrise: "Ø§Ù„Ø´Ø±ÙˆÙ‚",
    Dhuhr: "Ø§Ù„Ø¸Ù‡Ø±",
    Asr: "Ø§Ù„Ø¹ØµØ±",
    Maghrib: "Ø§Ù„Ù…ØºØ±Ø¨",
    Isha: "Ø§Ù„Ø¹Ø´Ø§Ø¡"
  };

  // ==========================================
  // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† API (Aladhan)
  // ==========================================
  async function fetchPrayerTimes() {
    const date = new Date();
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ù…ØµØ±ÙŠØ© (Method 5) ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠØŒ Ø£Ùˆ Ø±Ø§Ø¨Ø·Ø© Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ
    const apiURL = `https://api.aladhan.com/v1/timings/${date.getDate()}-${date.getMonth()+1}-${date.getFullYear()}?latitude=${userLat}&longitude=${userLng}&method=5`;

    try {
      const response = await fetch(apiURL);
      const data = await response.json();
      
      if(data.code === 200) {
        prayerTimes = data.data.timings;
        updateUI(data.data);
      }
    } catch (error) {
      console.error("Error fetching prayers:", error);
      document.getElementById('location-text').innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
    }
  }

  // ==========================================
  // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
  // ==========================================
  function updateUI(data) {
    // Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ ÙˆØ§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ
    const hijri = data.date.hijri;
    const gregorian = data.date.gregorian;
    document.getElementById('date-text').innerText = `${hijri.day} ${hijri.month.ar} ${hijri.year} Ù‡Ù€  |  ${gregorian.date}`;
    
    // ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„ÙˆØ§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    for (const [key, value] of Object.entries(prayerTimes)) {
      const row = document.getElementById(`row-${key}`);
      const timeSpan = document.getElementById(`time-${key}`);
      if (row && timeSpan) {
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ù…Ù† 24 Ø¥Ù„Ù‰ 12 Ø³Ø§Ø¹Ø©
        timeSpan.innerText = formatTime12(value);
      }
    }

    startCountdown();
  }

  // ==========================================
  // 3. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
  // ==========================================
  function startCountdown() {
    setInterval(() => {
      const now = new Date();
      let nextPrayerName = null;
      let nextPrayerTime = null;
      let minDiff = Infinity;

      // ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙ„ÙˆØ§Øª Ù„Ù„ØªØ­Ù‚Ù‚
      const prayersOrdered = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];

      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù€ Highlight Ø§Ù„Ù‚Ø¯ÙŠÙ…
      document.querySelectorAll('.prayer-row').forEach(row => row.classList.remove('active'));

      for (let prayer of prayersOrdered) {
        const timeStr = prayerTimes[prayer]; // "04:55"
        if(!timeStr) continue;

        const [hours, minutes] = timeStr.split(':');
        const pDate = new Date();
        pDate.setHours(hours, minutes, 0);

        let diff = pDate - now;

        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙ„Ø§Ø© Ù…Ø±ØªØŒ ØªØ¬Ø§Ù‡Ù„Ù‡Ø§ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…
        if (diff < 0) continue;

        if (diff < minDiff) {
          minDiff = diff;
          nextPrayerName = prayer;
          nextPrayerTime = pDate;
        }
      }

      // Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Øª ØµÙ„ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ… (Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø´Ø§Ø¡)ØŒ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù‡ÙŠ Ø§Ù„ÙØ¬Ø± ØºØ¯Ø§Ù‹
      if (!nextPrayerName) {
        nextPrayerName = 'Fajr';
        const [hours, minutes] = prayerTimes['Fajr'].split(':');
        nextPrayerTime = new Date();
        nextPrayerTime.setDate(nextPrayerTime.getDate() + 1);
        nextPrayerTime.setHours(hours, minutes, 0);
        minDiff = nextPrayerTime - now;
      }

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
      const hoursLeft = Math.floor((minDiff / (1000 * 60 * 60)) % 24);
      const minutesLeft = Math.floor((minDiff / (1000 * 60)) % 60);
      const secondsLeft = Math.floor((minDiff / 1000) % 60);

      document.getElementById('countdown').innerText = 
        `${pad(hoursLeft)}:${pad(minutesLeft)}:${pad(secondsLeft)}`;
      
      document.getElementById('next-prayer-name').innerText = prayerNamesAr[nextPrayerName];

      // ØªÙ…ÙŠÙŠØ² Ø§Ù„ØµÙ Ø§Ù„Ù†Ø´Ø·
      const activeRow = document.getElementById(`row-${nextPrayerName}`);
      if(activeRow) activeRow.classList.add('active');

    }, 1000);
  }

  // ==========================================
  // 4. Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©
  // ==========================================
  function formatTime12(time24) {
    const [hours, minutes] = time24.split(':');
    let h = parseInt(hours);
    const suffix = h >= 12 ? 'Ù…' : 'Øµ';
    h = h % 12;
    h = h ? h : 12; 
    return `${h}:${minutes} ${suffix}`;
  }

  function pad(num) {
    return num.toString().padStart(2, '0');
  }

  function getLocation() {
    if (navigator.geolocation) {
      document.getElementById('location-text').innerText = "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...";
      navigator.geolocation.getCurrentPosition(
        (position) => {
          userLat = position.coords.latitude;
          userLng = position.coords.longitude;
          document.getElementById('location-text').innerText = "Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ";
          fetchPrayerTimes();
        },
        (error) => {
          document.getElementById('location-text').innerText = "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© (Ø§ÙØªØ±Ø§Ø¶ÙŠ)";
          fetchPrayerTimes(); // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø±ÙØ¶
        }
      );
    } else {
      alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
    }
  }

  // Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
  fetchPrayerTimes();

</script>
</body>
</html>
